flowchart TB
  %% Governance-first Azure Enterprise Landing Zone

  %% ---------- Styles ----------
  classDef gov fill:#ecfeff,stroke:#06b6d4,stroke-width:1px,color:#111827;
  classDef repo fill:#eef2ff,stroke:#3b82f6,stroke-width:1px,color:#111827;
  classDef platform fill:#f0fdf4,stroke:#22c55e,stroke-width:1px,color:#111827;
  classDef spoke fill:#fff7ed,stroke:#f97316,stroke-width:1px,color:#111827;
  classDef obs fill:#fdf2f8,stroke:#ec4899,stroke-width:1px,color:#111827;
  classDef delivery fill:#fefce8,stroke:#eab308,stroke-width:1px,color:#111827;

  %% ---------- Governance Layer (Top) ----------
  subgraph GOV["Tenant Governance. Guardrails first"]
    direction LR
    MG["Management Groups\nPlatform. LandingZones. Sandbox"]
    POL["Azure Policy + Initiatives\nCompliance. Guardrails"]
    ENTRA["Entra ID\nRBAC. Groups. PIM"]
    MONPLANE["Monitoring Plane\nLog Analytics. Azure Monitor"]
  end

  %% ---------- Platform Layer (Hub) ----------
  subgraph HUB["Platform Subscription. Hub"]
    direction LR
    HUBVNET["Hub VNet"]
    FW["Azure Firewall\nEgress control"]
    DNS["Private DNS Zones"]
    GW["VPN/ExpressRoute Gateway"]
    SHARED["Shared Services\nKey Vault. ACR. Monitor"]
  end

  %% ---------- Landing Zones (Spokes) ----------
  subgraph LZ["Landing Zone Subscriptions. Spokes"]
    direction LR
    SPOKEVNET["Spoke VNets\nWorkloads"]
    PE["Private Endpoints"]
    AKS["AKS. App Service. Functions"]
    DATA["Data Services\nStorage. SQL. Cosmos"]
  end

  %% ---------- Delivery ----------
  subgraph DEL["Delivery"]
    direction LR
    CICD["Azure DevOps Pipelines / GitHub Actions"]
    TF["Terraform\nRemote state + workspaces"]
    PLAN["Plan → Apply → Validate"]
  end

  %% ---------- Repository Modules (Implementation) ----------
  subgraph REPO["Repository modules. Implementation units"]
    direction LR
    CORE["modules/core\nMG + subscriptions\nBaseline resources"]
    IDMOD["modules/identity\nRBAC assignments\nPIM-ready roles"]
    NETMOD["modules/network\nHub-spoke\nDNS + routing"]
    SECMOD["modules/security\nPolicy sets\nDefender baselines"]
    MONMOD["modules/monitoring\nDiagnostics\nAlerts + dashboards"]
  end

  %% ---------- Governance applies everywhere ----------
  MG --> HUB
  MG --> LZ
  POL --> HUB
  POL --> LZ
  ENTRA --> HUB
  ENTRA --> LZ
  MONPLANE --> HUB
  MONPLANE --> LZ

  %% ---------- Hub to Spokes ----------
  HUBVNET --> FW
  HUBVNET --> DNS
  HUBVNET --> GW
  HUBVNET --> SHARED
  FW -. controlled egress .-> SPOKEVNET
  DNS -. name resolution .-> PE

  %% ---------- Workloads ----------
  SPOKEVNET --> PE
  SPOKEVNET --> AKS
  SPOKEVNET --> DATA

  %% ---------- Delivery drives modules ----------
  CICD --> PLAN --> TF
  TF --> CORE
  TF --> IDMOD
  TF --> NETMOD
  TF --> SECMOD
  TF --> MONMOD

  %% ---------- Modules realize governance + platform ----------
  CORE --> MG
  IDMOD --> ENTRA
  SECMOD --> POL
  MONMOD --> MONPLANE
  NETMOD --> HUB
  NETMOD --> LZ

  %% ---------- Apply styles ----------
  class MG,POL,ENTRA gov;
  class MONPLANE obs;
  class HUBVNET,FW,DNS,GW,SHARED platform;
  class SPOKEVNET,PE,AKS,DATA spoke;
  class CICD,TF,PLAN delivery;
  class CORE,IDMOD,NETMOD,SECMOD,MONMOD repo;